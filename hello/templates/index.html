{% extends "base.html" %}
{% load static %}

{% block content %}

<h1>
  Ask me anything
  <small>(about The Minimalist Entrepreneur)</small>
</h1>

<form action="/ask" method="post">
  {% csrf_token %}
  <textarea autofocus="autofocus" name="question" id="question">What is a minimalist entrepreneur?</textarea>
  <button type="submit" id="button">Ask</button>
</form>

<audio id="audio" controls autoplay>
  <source src="" type="audio/wav">
</audio>

<script>
  $(document).ready(function() {
    $("form").submit(function(e) {
      if (document.getElementById("question").value == "") {
        alert("Please ask a question!");
        e.preventDefault();
        return false;
      }

      let askButton = document.getElementById("button");
      askButton.textContent = "Asking...";
      askButton.disabled = true;

      $.ajax({
        type: 'POST',
        url: '/ask',
        data: $("form").serialize(),
        datatype: "json",
        encode: true
      }).done(function(data) {
        let audioSrc = data.audio_src_url;
        console.log(audioSrc);

        var audio = document.getElementById('audio');
        audio.src = audioSrc;

        audio.classList.add("showing");
        audio.play();

        askButton.textContent = "Ask";
        askButton.disabled = false;
      });

      e.preventDefault();
      return false;
    });

  });
</script>

{% endblock %}
